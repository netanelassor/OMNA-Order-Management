<div class="page-container">

    <h2 class="page-title">{{pageTitle}}</h2>
    <div class="mat-elevation-z8">
        <div class="table-container">
            <table mat-table [dataSource]="dataSource" matSort *ngIf="dataSource.data.length > 0">

                <!-- ID Column -->
                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
                    <td mat-cell *matCellDef="let order">
                        <button mat-button color="primary" (click)="showOrderDetails(order)">#{{order.id}}</button>
                    </td>
                </ng-container>

                <!--  description Column -->
                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Description </th>
                    <td mat-cell *matCellDef="let order"> {{order.description}} </td>
                </ng-container>

                <!-- Customer Name Column -->
                <ng-container matColumnDef="customerName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Customer </th>
                    <td mat-cell *matCellDef="let order"> {{order.customer.name}} </td>
                </ng-container>


                <!-- Status Column -->
                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                    <td mat-cell *matCellDef="let order">
                        <div class="status {{order.status | orderStatusEnum}}">{{order.status | orderStatusEnum}}</div>
                    </td>
                </ng-container>

                <!-- Date Of Creation Column -->
                <ng-container matColumnDef="lastUpdateDate">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Update Date</th>
                    <td mat-cell *matCellDef="let order"> {{order.lastUpdateDate | date:"short"}} </td>
                </ng-container>

                <!-- Action Column -->
                <ng-container matColumnDef="quickAction">
                    <th mat-header-cell *matHeaderCellDef> </th>
                    <td mat-cell *matCellDef="let order">
                        <ng-container *ngIf="order.status === OrderStatusEnum.Open">
                            <button mat-stroked-button (click)="updateOrderStatus(order, OrderStatusEnum.Submitted)">
                                <span>Submit</span>
                            </button>
                        </ng-container>
                        <ng-container *ngIf="order.status === OrderStatusEnum.Hold">
                            <button mat-stroked-button (click)="updateOrderStatus(order, OrderStatusEnum.Open)">
                                <span>Reopen</span>
                            </button>
                        </ng-container>
                    </td>
                </ng-container>

                <ng-container matColumnDef="menuAction" stickyEnd>
                    <th mat-header-cell *matHeaderCellDef> </th>
                    <td mat-cell *matCellDef="let order" class="text-end">
                        <ng-container *ngIf="order.status === OrderStatusEnum.Open">
                            <button mat-icon-button [matMenuTriggerFor]="menu" [matMenuTriggerData]="{order: order}">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                        </ng-container>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>


            <div class="no-data-wrapper" *ngIf="dataSource.data.length === 0">
                <img src="assets/img/no-data.png" />
                <div class="no-data-text">
                    Your "{{status | orderStatusEnum}}" order list is empty.
                </div>
            </div>
        </div>

        <mat-paginator #paginator [pageSizeOptions]="[14, 25, 50, 100]" *ngIf="dataSource.data.length > 14">
        </mat-paginator>
    </div>
</div>


<mat-menu #menu="matMenu" xPosition="before">
    <ng-template matMenuContent let-order="order">
        <button mat-menu-item (click)="updateOrderStatus(order, OrderStatusEnum.Submitted)">
            <mat-icon>check_circle</mat-icon>
            <span>Submit</span>
        </button>
        <button mat-menu-item (click)="updateOrderStatus(order, OrderStatusEnum.Canceled)">
            <mat-icon>cancel</mat-icon>
            <span>Cancel</span>
        </button>
        <button mat-menu-item (click)="updateOrderStatus(order, OrderStatusEnum.Hold)">
            <mat-icon>pan_tool</mat-icon>
            <span>Hold</span>
        </button>
        <button mat-menu-item>
            <a href="mailto:{{order.customer.contactDetails.mail}}">
                <mat-icon>email</mat-icon>
                <span>Mail to customer</span>
            </a>
        </button>
    </ng-template>
</mat-menu>